<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Task Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2&display=swap" rel="stylesheet">

<style>
  body {
    font-family: 'Baloo 2', cursive;
    background: linear-gradient(to right, #ffe6e6, #fff5cc);
    color: #333;
    transition: background 0.3s, color 0.3s;
    padding: 10px;
  }
  body.dark {
    background: linear-gradient(to right, #2b2b2b, #444);
    color: #eee;
  }
  h1 {
    text-align: center;
    margin-bottom: 10px;
    color: #ff6b6b;
  }
  #toggleTheme {
    margin: 10px auto;
    display: block;
    padding: 8px 15px;
    cursor: pointer;
    border: none;
    background-color: #4ecdc4;
    color: #fff;
    font-weight: bold;
    border-radius: 20px;
    transition: 0.3s;
  }
  #toggleTheme:hover {
    background-color: #38b2ac;
  }
  table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    margin-bottom: 30px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    border-radius: 10px;
    overflow: hidden;
  }
  th, td {
    padding: 12px;
    text-align: center;
  }
  th {
    background: #4ecdc4;
    color: white;
    font-size: 16px;
  }
  body.dark th { background: #1a8f87; }
  tr:nth-child(even) { background: #fff7e6; }
  body.dark tr:nth-child(even) { background: #333; }
  tr:nth-child(odd) { background: #ffe6e6; }
  body.dark tr:nth-child(odd) { background: #444; }
  .overdue { color: red; font-weight: bold; }
  input[type="text"], input[type="time"], select {
    width: 90%;
    padding: 5px;
    border-radius: 10px;
    border: 1px solid #ccc;
    font-size: 14px;
  }
  input[type="checkbox"] {
    transform: scale(1.3);
    margin-top: 5px;
  }
  #addTask {
    display: block;
    margin: 0 auto 20px auto;
    padding: 8px 15px;
    background-color: #ff6b6b;
    border: none;
    color: #fff;
    font-weight: bold;
    border-radius: 20px;
    cursor: pointer;
    transition: 0.3s;
  }
  #addTask:hover { background-color: #e55b5b; }
  canvas {
    background: #fff;
    border-radius: 15px;
    padding: 15px;
    box-shadow: 0 5px 10px rgba(0,0,0,0.1);
  }
</style>
</head>
<body>

<h1>Daily Task Tracker</h1>
<button id="toggleTheme">Toggle Dark/Light Mode</button>

<table id="taskTable">
  <thead>
    <tr>
      <th>Task</th>
      <th>Category</th>
      <th>Deadline</th>
      <th>Remove</th>
    </tr>
  </thead>
  <tbody id="taskBody"></tbody>
</table>

<button id="addTask">Add New Task</button>

<canvas id="progressChart" style="max-width: 600px; margin: auto;"></canvas>

<script>
// ===== STORAGE =====
let allTasks = JSON.parse(localStorage.getItem("allTasks")) || {};
let dailyProgress = JSON.parse(localStorage.getItem("dailyProgress")) || {};

let today = new Date().toISOString().split("T")[0];

// Create a new task list for today if none exists
if (!allTasks[today]) allTasks[today] = [];

let tasks = allTasks[today];

function saveTasks() {
  allTasks[today] = tasks;
  localStorage.setItem("allTasks", JSON.stringify(allTasks));
}

function saveProgress() {
  localStorage.setItem("dailyProgress", JSON.stringify(dailyProgress));
}

// ===== RENDER ROW =====
function addTaskRow(task) {
  const tbody = document.getElementById("taskBody");
  const tr = document.createElement("tr");

  // TASK NAME
  const tdTask = document.createElement("td");
  const inputTask = document.createElement("input");
  inputTask.type = "text";
  inputTask.value = task.name;
  inputTask.onchange = () => { task.name = inputTask.value; saveTasks(); };
  tdTask.appendChild(inputTask);

  // CHECKBOX
  const checkbox = document.createElement("input");
  checkbox.type = "checkbox";
  checkbox.checked = dailyProgress[today]?.[task.name] || false;
  checkbox.onchange = () => {
    dailyProgress[today] = dailyProgress[today] || {};
    dailyProgress[today][task.name] = checkbox.checked;
    saveProgress();
    renderProgress();
  };
  tdTask.appendChild(document.createElement("br"));
  tdTask.appendChild(checkbox);

  // CATEGORY
  const tdCat = document.createElement("td");
  const selectCat = document.createElement("select");
  ["Chores", "School", "Personal"].forEach(c => {
    let opt = document.createElement("option");
    opt.value = c;
    opt.text = c;
    if (task.category === c) opt.selected = true;
    selectCat.appendChild(opt);
  });
  selectCat.onchange = () => { task.category = selectCat.value; saveTasks(); };
  tdCat.appendChild(selectCat);

  // DEADLINE
  const tdDeadline = document.createElement("td");
  const inputTime = document.createElement("input");
  inputTime.type = "time";
  inputTime.value = task.deadline || "";
  inputTime.onchange = () => {
    task.deadline = inputTime.value;
    saveTasks();
    checkOverdue(task, tdDeadline);
  };
  tdDeadline.appendChild(inputTime);

  // DELETE BUTTON
  const tdRemove = document.createElement("td");
  const removeBtn = document.createElement("button");
  removeBtn.textContent = "âœ–";
  removeBtn.style.background = "#ff6b6b";
  removeBtn.style.color = "white";
  removeBtn.style.border = "none";
  removeBtn.style.borderRadius = "8px";
  removeBtn.style.padding = "5px 10px";
  removeBtn.style.cursor = "pointer";
  removeBtn.style.fontWeight = "bold";

  removeBtn.onclick = () => {
    tasks = tasks.filter(t => t !== task);
    allTasks[today] = tasks;
    saveTasks();

    // Remove progress entry for this task
    if (dailyProgress[today] && dailyProgress[today][task.name])
        delete dailyProgress[today][task.name];

    saveProgress();
    renderTasks();
    renderProgress();
  };
  tdRemove.appendChild(removeBtn);

  // ADD ROW
  tr.appendChild(tdTask);
  tr.appendChild(tdCat);
  tr.appendChild(tdDeadline);
  tr.appendChild(tdRemove);
  tbody.appendChild(tr);

  checkOverdue(task, tdDeadline);
}

// ===== CHECK OVERDUE =====
function checkOverdue(task, tdDeadline) {
  tdDeadline.classList.remove("overdue");
  if (task.deadline) {
    const now = new Date();
    const [h, m] = task.deadline.split(":");
    const deadline = new Date();
    deadline.setHours(h, m, 0, 0);
    if (now > deadline && !dailyProgress[today]?.[task.name])
      tdDeadline.classList.add("overdue");
  }
}

// ===== RENDER TABLE =====
function renderTasks() {
  const tbody = document.getElementById("taskBody");
  tbody.innerHTML = "";
  tasks.forEach(task => addTaskRow(task));
}

// ===== NEW TASK =====
function addNewTask() {
  const newTask = { name: "New Task", category: "Chores", deadline: "" };
  tasks.push(newTask);
  saveTasks();
  renderTasks();
  renderProgress();
}
document.getElementById("addTask").onclick = addNewTask;

// ===== PROGRESS CHART =====
function renderProgress() {
  const ctx = document.getElementById("progressChart").getContext("2d");

  const labels = Object.keys(dailyProgress).slice(-7);
  const data = labels.map(day => {
    const entries = dailyProgress[day];
    const completed = Object.values(entries).filter(v => v).length;
    const total = Object.keys(entries).length;
    return total ? Math.round((completed / total) * 100) : 0;
  });

  if (window.myChart) window.myChart.destroy();

  window.myChart = new Chart(ctx, {
    type: "bar",
    data: {
      labels,
      datasets: [
        {
          label: "% Tasks Completed",
          data,
          backgroundColor: "#ff6b6b"
        }
      ]
    },
    options: {
      scales: {
        y: { beginAtZero: true, max: 100 }
      }
    }
  });
}

// ===== THEME BUTTON =====
document.getElementById("toggleTheme").onclick = () =>
  document.body.classList.toggle("dark");

// ===== INIT =====
if (!dailyProgress[today]) dailyProgress[today] = {};
saveProgress();
renderTasks();
renderProgress();

</script>
</body>
</html>
